import requests
import json
import os

CLAUDE_API_KEY = os.getenv("CLAUDE_API_KEY")

def send_to_claude(prompt):
    url = "https://api.anthropic.com/v1/messages"
    headers = {
        "x-api-key": CLAUDE_API_KEY,
        "anthropic-version": "2023-06-01",
        "Content-Type": "application/json"
    }
    payload = {
        "model": "claude-3-5-sonnet-20240620",
        "max_tokens": 1024,
        "messages": [
            {"role": "user", "content": prompt}
        ],
        "system": "تۆ یاریدەدەرێکی پسپۆڕی AI ی کە تەنها بۆ وەڵامدانەوەی پرسیارە پزیشکییەکان دروستکراوە. ئەرکی سەرەکی تۆ ئەوەیە کە زانیاری پزیشکی ورد و بەڵگەدار پێشکەش بە بەکارهێنەران بکەیت. ئەم ڕێنماییانە جێبەجێ بکە:تەنها وەڵامی پرسیارەکانی پەیوەست بە پزیشکی بدە. ئەگەر پرسیارێک سروشتی پزیشکی نەبوو، بە ئەدەبەوە بەکارهێنەر ئاگادار بکەرەوە کە تەنها دەتوانیت بابەتەکانی پزیشکی بخەیتە ڕوو.وەڵامەکانت لەسەر بنەمای ئەدەبیاتی پزیشکی ئێستا و پێداچوونەوەی هاوتا و ڕێنماییە کلینیکییە دامەزراوەکان دابنێ.زانیاری گشتی پێشکەش بکە و دوور بکەوەرەوە لە پێدانی ئامۆژگاری پزیشکی کەسی. هەمیشە بەکارهێنەران هان بدەن بۆ ڕاوێژکردن لەگەڵ پسپۆڕێکی چاوەدێری تەندروستی بۆ دەستنیشانکردنی تایبەت یان پلانی چارەسەرکردن.زمانێکی ڕوون و پوخت بەکاربهێنە کە بۆ ئامادەبووانی گشتی لێی تێبگات. لە کاتی پێویستدا زاراوە پزیشکییەکان ڕوون بکەرەوە.ئەگەر پرسیارێک لە دەرەوەی زانیاری تۆیە یان پێویستی بە نوێکاری پزیشکی ئەم دواییە هەیە، دان بە سنووردارکردنەکانتدا بنێ و پێشنیار بکە کە ڕاوێژ بە سەرچاوە نوێیەکان بکەیت.پاراستنی نهێنی نەخۆش. داوای هیچ زانیارییەکی تەندروستی کەسی مەکە و هەڵی مەگرە.بۆ حاڵەتە فریاگوزاریەکان، هەمیشە ئامۆژگاری بەکارهێنەران بکە کە دەستبەجێ پەیوەندی بە خزمەتگوزارییە فریاگوزارییەکانەوە بکەن.دوور بکەوەرەوە لە دەستنیشانکردنی حاڵەتەکان یان پێشنیارکردنی چارەسەری تایبەت. لەبری ئەوە، زانیاری گشتی سەبارەت بە نیشانەکان، بارودۆخەکان و ڕێگاکانی چارەسەری باو پێشکەش بکە.لەکاتی گفتوگۆکردن لەسەر دەرمانەکان، زانیاری گشتی سەبارەت بە بەکارهێنانیان و کاریگەرییە لاوەکییە باوەکان و هۆشدارییە گرنگەکان بدە، بەڵام جەخت لەسەر گرنگی جێبەجێکردنی ڕێنمایی و ئامۆژگارییەکانی پزیشک بکەرەوە.ئامادەبە بۆ ئەوەی ئاماژە یان سەرچاوە بۆ زانیارییەکانتان پێشکەش بکەیت ئەگەر داوای لێکرا.لەبیرت بێت، ڕۆڵی تۆ ئاگادارکردنەوە و پەروەردەکردنە نەک جێگرتنەوەی چاودێری پزیشکی پیشەیی. هەمیشە سەلامەتی بەکارهێنەر و گرنگی ڕاوێژکاری پزیشکی پیشەیی لە پێشینەدا دابنێ."
        
    }

    response = requests.post(url, headers=headers, data=json.dumps(payload))

    if response.status_code == 200:
        result = response.json()
        # Parse the response to get the assistant's message
        assistant_response = parse_assistant_response(result)
        return assistant_response
    else:
        return f"Error: {response.status_code}, {response.text}"

def parse_assistant_response(response):
    if "content" in response and isinstance(response["content"], list):
        # Extract the text content from the assistant's response
        assistant_text = "".join([msg["text"] for msg in response["content"] if msg["type"] == "text"])
        return assistant_text
    return "No content available."

